# /create-pr: PR 템플릿 기반 자동 PR 생성

`.github/pull_request_template.md`의 PR 템플릿 양식에 맞춰 현재 브랜치의 변경사항을 분석하고 자동으로 Pull Request를 생성합니다.

## PR 템플릿 참조
- **템플릿 위치**: `.github/pull_request_template.md`
- **반드시 이 양식을 따라야 함**: PR 생성 시 템플릿의 모든 섹션을 포함

## 실행 과정

### 0. PR 템플릿 확인
- **먼저 `.github/pull_request_template.md` 파일을 읽어야 함**
- 템플릿의 모든 섹션과 체크리스트 항목 파악
- PR 제목 규칙 확인

### 1. 브랜치 분석
- 현재 브랜치명 확인
- main 브랜치와의 차이점 분석 (`git diff main...HEAD`)
- 커밋 히스토리 확인 (`git log main..HEAD`)
- 변경된 파일 목록 파악

### 2. 변경사항 분석
- 구현된 기능 식별
  - 포인트 조회/충전/사용/내역 조회 기능 확인
  - 테스트 코드 작성 여부 확인
  - 동시성 제어 구현 여부 확인
- 테스트 커버리지 확인
  - 단위 테스트 작성 여부
  - 통합 테스트 작성 여부
  - 예외 케이스 테스트 여부
- README.md 문서화 확인

### 3. 체크리스트 자동 체크
PR 템플릿의 각 항목을 자동으로 확인하고 체크:

#### TDD 기본 (4개)
- 포인트 조회/충전/사용/내역 조회 기능 구현 여부
- 각 기능의 단위 테스트 작성 여부
- Red-Green-Refactor 사이클 준수 (커밋 메시지로 추정)
- 테스트 가능한 구조 설계 (Service/Repository 분리)

#### TDD 심화 (4개)
- 예외 케이스 테스트 작성 여부
- 통합 테스트 작성 여부
- 동시성 제어 구현 여부 (Lock, synchronized 등)
- README.md 동시성 제어 문서화 여부

#### AI 활용 (2개)
- Claude Code 활용 흔적 (커밋 메시지, 코드 스타일)
- Custom Commands 활용 여부

### 4. 커밋 링크 생성
- 각 커밋에 대한 간단한 설명과 SHA 링크 생성
- 기능별로 그룹화하여 정리
  - 포인트 조회 관련 커밋
  - 포인트 충전 관련 커밋
  - 포인트 사용 관련 커밋
  - 동시성 제어 관련 커밋
  - 테스트 관련 커밋

### 5. 리뷰 포인트 제안
diff와 코드 변경사항을 분석하여 리뷰 포인트를 자동으로 사용자에게 제안:
- **동시성 제어 방식**: 코드에서 사용한 Lock, synchronized 등의 방식과 선택 이유
- **예외 처리 전략**: Custom Exception 설계, 예외 계층 구조에 대한 질문
- **테스트 전략**: 단위/통합 테스트 범위, Mock 사용 전략에 대한 질문
- **비즈니스 로직**: 포인트 충전/사용 검증 로직의 구현 방식
- **아키텍처 선택**: 레이어 분리, 의존성 주입 등의 설계 결정
- **성능 최적화**: 트랜잭션 범위, 데이터베이스 접근 패턴
- **개선 가능한 부분**: 리팩토링 가능 영역, 코드 품질 개선 포인트

### 6. 간단 회고 제안
diff를 분석하여 회고 내용을 자동으로 사용자에게 제안:
- **잘한 점**:
  - TDD 사이클 준수 여부 (테스트 커밋 → 구현 커밋 패턴 확인)
  - 테스트 커버리지 및 엣지 케이스 처리
  - 코드 구조화 및 레이어 분리
  - 문서화 및 주석 품질
  - 동시성 제어 구현
- **어려운 점**:
  - 복잡한 비즈니스 로직 구현 (코드 복잡도 기반)
  - 동시성 이슈 해결 (Lock 관련 코드 확인)
  - 예외 상황 처리 (예외 처리 코드 양)
  - 테스트 코드 작성 (테스트 파일 복잡도)
- **다음 시도**:
  - 발견된 개선 가능 영역
  - 추가 테스트가 필요한 부분
  - 리팩토링 대상
  - 성능 개선 포인트

### 7. PR 제목 생성
- STEP 번호를 사용자에게 확인 (STEP01, STEP02 등)
- 사용자 이름 확인
- 형식: `[STEP0X] 이름`

### 8. PR 생성
- PR 본문을 템플릿에 맞춰 구성
- `gh pr create` 명령어로 PR 생성
- 생성된 PR URL 반환

## 주의사항

- PR 생성 전에 현재 브랜치가 원격에 푸시되어 있어야 합니다
- 사용자 확인이 필요한 항목은 반드시 사용자에게 물어봅니다
- 자동 체크된 항목도 사용자가 최종 확인할 수 있도록 합니다
- 커밋 메시지와 코드를 기반으로 분석하되, 불확실한 경우 사용자에게 확인합니다

## 사용 예시

```bash
/create-pr
```

명령어 실행 후:
1. PR 템플릿을 읽고 구조를 파악합니다
2. 브랜치의 변경사항과 커밋을 분석합니다
3. 체크리스트를 자동으로 체크합니다
4. 커밋 링크를 기능별로 정리합니다
5. diff를 분석하여 **리뷰 포인트를 제안**합니다 (동시성 제어, 예외 처리 등)
6. 코드 변경사항을 기반으로 **회고 내용을 제안**합니다 (잘한 점, 어려운 점, 다음 시도)
7. STEP 번호와 사용자 이름을 확인합니다
8. 제안된 내용을 사용자가 검토하고 수정할 수 있습니다
9. 최종 확인 후 PR을 생성합니다