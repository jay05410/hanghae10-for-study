# 비즈니스 요구사항 정의

## 목차
1. [스테이크홀더 요구사항](#1-스테이크홀더-요구사항)
2. [기능적 요구사항](#2-기능적-요구사항)
3. [비기능적 요구사항](#3-비기능적-요구사항)
4. [비즈니스 규칙](#4-비즈니스-규칙)
5. [제약사항](#5-제약사항)

---

## 1. 스테이크홀더 요구사항

### 1.1 고객 (Primary User)
**페르소나**: 김민지 (28세, 직장인)
- **목표**: 피로 회복과 활력 증진에 도움되는 티를 편리하게 구매
- **Pain Points**:
    - 차 종류가 너무 많아 선택이 어려움
    - 매번 같은 차만 마시게 됨
    - 온라인에서 품질 좋은 차를 찾기 어려움
- **니즈**:
    - 내 상태에 맞는 차 추천
    - 7일 루틴으로 다양한 차 경험
    - 간편한 온라인 구매

### 1.2 사업 운영자
- **목표**: 티 큐레이션 서비스를 통한 수익 창출
- **요구사항**:
    - 일일 생산 한도 관리 (초기 30박스)
    - 재고 정합성 보장
    - 인기 조합 데이터 분석
    - 제조사와의 원활한 연동

### 1.3 제조사 (Partner)
- **목표**: 정확한 주문 정보 수신 및 적시 제조
- **요구사항**:
    - 실시간 주문 정보 전달
    - 조합별 상세 레시피 정보
    - 배송지 정보

---

## 2. 기능적 요구사항

### 2.1 상품 관리

| ID | 요구사항 | 우선순위 | 설명 |
|----|---------|---------|------|
| FR-001 | 박스 상품 조회 | 높음 | 기본/프리미엄 박스 정보 제공 |
| FR-002 | 선택 옵션 조회 | 높음 | 컨디션/기분/향 옵션 제공 |
| FR-003 | 조합별 재고 조회 | 높음 | 실시간 재고 수량 확인 |
| FR-004 | 일일 생산 한도 체크 | 높음 | 일일 총 생산량 제한 |
| FR-005 | 인기 조합 통계 | 높음 | 최근 3일 TOP 5 조회 |

### 2.2 재고 관리

| ID | 요구사항 | 우선순위 | 설명 |
|----|---------|---------|------|
| FR-006 | 재고 차감 | 높음 | 주문 시 재고 차감 (동시성 제어) |
| FR-007 | 재고 복원 | 높음 | 주문 취소/결제 실패 시 복원 |
| FR-008 | 재고 정합성 보장 | 높음 | 동시 주문 시에도 정확한 재고 관리 |

### 2.3 장바구니

| ID | 요구사항 | 우선순위 | 설명 |
|----|---------|---------|------|
| FR-009 | 장바구니 추가 | 높음 | 선택한 박스 장바구니에 추가 |
| FR-010 | 장바구니 조회 | 높음 | 현재 장바구니 내역 및 재고 상태 |
| FR-011 | 장바구니 삭제 | 높음 | 특정 항목 또는 전체 삭제 |
| FR-012 | 여러 조합 담기 | 중간 | 다른 조합의 박스 여러 개 담기 |

### 2.4 주문/결제

| ID | 요구사항 | 우선순위 | 설명 |
|----|---------|---------|------|
| FR-013 | 주문 생성 | 높음 | 장바구니 기반 주문 생성 |
| FR-014 | 재고 차감 | 높음 | 주문 생성과 동시에 재고 차감 |
| FR-015 | 포인트 결제 | 높음 | 잔액 기반 결제 처리 |
| FR-016 | 쿠폰 할인 적용 | 높음 | 쿠폰 유효성 검증 및 할인 적용 |
| FR-017 | 주문 취소 | 중간 | 주문 취소 및 재고/포인트 복원 |
| FR-018 | 주문 내역 조회 | 중간 | 사용자별 주문 이력 (페이징) |
| FR-019 | 주문 상세 조회 | 중간 | 7일 구성 포함 상세 정보 |

### 2.5 쿠폰 시스템

| ID | 요구사항 | 우선순위 | 설명 |
|----|---------|---------|------|
| FR-020 | 선착순 쿠폰 발급 | 높음 | 한정 수량 선착순 발급 |
| FR-021 | 중복 발급 방지 | 높음 | 1인 1매 제한 |
| FR-022 | 쿠폰 유효성 검증 | 높음 | 만료일, 사용 여부 확인 |
| FR-023 | 쿠폰 사용 처리 | 높음 | 주문 시 쿠폰 사용 상태 변경 |
| FR-024 | 쿠폰 복원 | 중간 | 주문 취소 시 쿠폰 복원 |

### 2.6 외부 시스템 연동

| ID | 요구사항 | 우선순위 | 설명 |
|----|---------|---------|------|
| FR-025 | 주문 데이터 전송 | 높음 | 제조사에 주문 정보 전송 (비동기) |
| FR-026 | Outbox 패턴 | 높음 | 이벤트 저장 후 비동기 전송 |
| FR-027 | 전송 재시도 | 높음 | 실패 시 최대 3회 재시도 |
| FR-028 | 전송 실패 알림 | 중간 | 3회 실패 시 관리자 알림 |
| FR-029 | 주문 성공 보장 | 높음 | 외부 전송 실패해도 주문은 성공 |

### 2.7 포인트 관리

| ID | 요구사항 | 우선순위 | 설명 |
|----|---------|---------|------|
| FR-030 | 포인트 충전 | 낮음 | 사용자 포인트 충전 |
| FR-031 | 포인트 차감 | 높음 | 주문 결제 시 차감 |
| FR-032 | 포인트 환불 | 중간 | 주문 취소 시 환불 |
| FR-033 | 포인트 내역 조회 | 낮음 | 충전/사용 이력 조회 |

---

## 3. 비기능적 요구사항

### 3.1 성능 요구사항

| ID | 카테고리 | 요구사항 | 측정 기준 | 우선순위 |
|----|---------|---------|----------|---------|
| NFR-001 | 성능 | 상품 조회 응답 시간 | 평균 100ms 이하 | 높음 |
| NFR-002 | 성능 | 재고 확인 응답 시간 | 평균 200ms 이하 | 높음 |
| NFR-003 | 성능 | 주문 처리 응답 시간 | 평균 2초 이하 | 높음 |
| NFR-004 | 성능 | 인기 통계 조회 | 평균 500ms 이하 | 중간 |

### 3.2 동시성 요구사항

| ID | 카테고리 | 요구사항 | 측정 기준 | 우선순위 |
|----|---------|---------|----------|---------|
| NFR-005 | 동시성 | 동시 주문 처리 | 초당 100건 | 높음 |
| NFR-006 | 동시성 | 재고 정합성 보장 | 100% 정확성 | 높음 |
| NFR-007 | 동시성 | 쿠폰 발급 정합성 | 100% 정확성 | 높음 |
| NFR-008 | 동시성 | 데드락 방지 | 락 타임아웃 3초 | 높음 |

### 3.3 가용성 요구사항

| ID | 카테고리 | 요구사항 | 측정 기준 | 우선순위 |
|----|---------|---------|----------|---------|
| NFR-009 | 가용성 | 서비스 가동률 | 99% 이상 | 높음 |
| NFR-010 | 가용성 | 외부 연동 장애 격리 | 주문 처리 영향 없음 | 높음 |
| NFR-011 | 가용성 | DB 장애 대응 | Read Replica 활용 | 중간 |

### 3.4 확장성 요구사항

| ID | 카테고리 | 요구사항 | 측정 기준 | 우선순위 |
|----|---------|---------|----------|---------|
| NFR-012 | 확장성 | 일일 처리 용량 | 1,000 주문/일 | 중간 |
| NFR-013 | 확장성 | 수평 확장 | 무상태 설계 | 중간 |
| NFR-014 | 확장성 | DB 커넥션 풀 | 최대 50 커넥션 | 중간 |

### 3.5 보안 요구사항

| ID | 카테고리 | 요구사항 | 측정 기준 | 우선순위 |
|----|---------|---------|----------|---------|
| NFR-015 | 보안 | 인증/인가 | JWT 기반 | 중간 |
| NFR-016 | 보안 | 개인정보 암호화 | AES-256 | 중간 |
| NFR-017 | 보안 | API Rate Limiting | 사용자당 초당 10건 | 낮음 |

### 3.6 모니터링 요구사항

| ID | 카테고리 | 요구사항 | 측정 기준 | 우선순위 |
|----|---------|---------|----------|---------|
| NFR-018 | 모니터링 | 로그 수집 | 모든 주요 트랜잭션 | 중간 |
| NFR-019 | 모니터링 | 메트릭 수집 | 실시간 수집 | 낮음 |
| NFR-020 | 모니터링 | 에러 추적 | 즉시 알림 | 중간 |

---

## 4. 비즈니스 규칙

### 4.1 상품 규칙
- **BR-001**: 박스는 기본(29,000원)과 프리미엄(49,000원) 2종류만 판매
- **BR-002**: 모든 박스는 7일 구성 (월~일)
- **BR-003**: 선택 옵션은 3가지 카테고리 (컨디션/기분/향), 각 3개 옵션
- **BR-004**: 총 27가지 조합 가능 (3 × 3 × 3)

### 4.2 재고 규칙
- **BR-005**: 일일 생산 한도는 상품별로 설정 (초기: 기본 30박스, 프리미엄 20박스)
- **BR-006**: 재고 차감 시점은 주문 생성 시점 (결제 전)
- **BR-007**: 재고 부족 시 주문 불가
- **BR-008**: 주문 취소 시 즉시 재고 복원
- **BR-009**: 재고는 음수가 될 수 없음

### 4.3 주문 규칙
- **BR-010**: 장바구니는 최대 10개 항목
- **BR-011**: 동일 조합은 장바구니에 1개만 담기 가능
- **BR-012**: 주문 번호 형식: `ORD-YYYYMMDD-XXX` (일련번호)
- **BR-013**: 결제 완료 전 주문은 5분 후 자동 취소
- **BR-014**: 제조 시작 후에는 취소 불가

### 4.4 쿠폰 규칙
- **BR-015**: 1인 1매 제한 (동일 쿠폰)
- **BR-016**: 최소 주문 금액 충족 필요
- **BR-017**: 쿠폰 유효기간은 발급일로부터 N일
- **BR-018**: 주문 취소 시 쿠폰 복원 (만료 전에만)
- **BR-019**: 만료된 쿠폰은 사용 불가

### 4.5 포인트 규칙
- **BR-020**: 포인트는 음수가 될 수 없음
- **BR-021**: 포인트 사용 단위: 100원
- **BR-022**: 환불 시 원래 결제 수단으로 환불 (포인트 → 포인트)

### 4.6 결제 규칙
- **BR-023**: 결제 금액 = 총 상품 금액 - 쿠폰 할인
- **BR-024**: 포인트 잔액 부족 시 결제 불가
- **BR-025**: 결제 실패 시 재고 즉시 복원

---

## 5. 제약사항

### 5.1 기술적 제약사항
- **C-001**: 동시성 제어를 위해 비관적 락 또는 Redis 분산 락 사용 필수
- **C-002**: 외부 연동은 Outbox 패턴으로 구현 (트랜잭션 보장)
- **C-003**: 재고 조회는 캐싱 불가 (실시간 정확성 필요)
- **C-004**: 인기 통계는 1시간 캐싱 허용

### 5.2 운영 제약사항
- **C-005**: 일일 생산 한도는 오전 9시 기준으로 리셋
- **C-006**: 제조사 시스템 다운타임: 매일 새벽 3-4시
- **C-007**: 배송 리드타임: 주문 후 2-3일

### 5.3 법적 제약사항
- **C-008**: 식품 위생법 준수 (일반 식품)
- **C-009**: 의학적 효능 표기 불가
- **C-010**: 개인정보보호법 준수 (암호화 저장)

### 5.4 비즈니스 제약사항
- **C-011**: 초기 MVP는 포인트 결제만 지원 (PG 연동 제외)
- **C-012**: 배송비 무료 (상품 가격에 포함)
- **C-013**: 교환/반품 불가 (식품 특성상)

---

## 6. 우선순위

### P0 (Must Have - 1주일 내 구현)
- 상품 조회 및 재고 확인
- 장바구니 기능
- 주문/결제 처리
- 재고 동시성 제어
- 쿠폰 발급 및 사용
- 외부 연동 (Outbox)

### P1 (Should Have - 추후 구현)
- 인기 조합 통계
- 주문 취소
- 포인트 충전
- 관리자 기능

### P2 (Nice to Have - 고도화)
- 추천 알고리즘
- 정기구독
- 리뷰 시스템
- 알림 기능

---

## 7. 성공 기준

### 기능적 성공 기준
- [ ] 동시 100명이 같은 조합 주문해도 재고 정합성 보장
- [ ] 선착순 쿠폰 100장 발급 시 정확히 100명만 발급
- [ ] 외부 시스템 장애 시에도 주문 성공 처리
- [ ] 주문 취소 시 재고/포인트/쿠폰 모두 복원

### 비기능적 성공 기준
- [ ] 상품 조회 평균 응답 시간 100ms 이하
- [ ] 주문 처리 평균 응답 시간 2초 이하
- [ ] 서비스 가동률 99% 이상
- [ ] 동시 주문 처리 초당 100건 이상

---

## 8. 리스크 관리

### 높은 리스크
| 리스크 | 영향도 | 발생 확률 | 대응 방안 |
|-------|-------|----------|----------|
| 재고 동시성 이슈 | 높음 | 높음 | 비관적 락 + 철저한 테스트 |
| 쿠폰 중복 발급 | 높음 | 중간 | Redis Lua Script + DB 제약 |
| 외부 시스템 장애 | 중간 | 중간 | Outbox 패턴 + Circuit Breaker |

### 중간 리스크
| 리스크 | 영향도 | 발생 확률 | 대응 방안 |
|-------|-------|----------|----------|
| DB 성능 저하 | 중간 | 중간 | 인덱스 최적화 + 캐싱 |
| 서버 과부하 | 중간 | 낮음 | Rate Limiting + 수평 확장 |

---

## 변경 이력
| 버전 | 날짜 | 변경 내용 | 작성자 |
|-----|------|----------|--------|
| 1.0 | 2025-10-31 | 초안 작성 | - |