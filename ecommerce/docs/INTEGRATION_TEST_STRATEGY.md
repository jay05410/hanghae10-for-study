# ν†µν•© ν…μ¤νΈ μ „λµ λ° μ»¤λ²„λ¦¬μ§€

## π“ κ°μ”

μ΄ λ¬Έμ„λ” ν”„λ΅μ νΈμ ν†µν•© ν…μ¤νΈ μ „λµκ³Ό μ»¤λ²„λ¦¬μ§€λ¥Ό μ •λ¦¬ν• λ¬Έμ„μ…λ‹λ‹¤. μ–΄λ–¤ APIλ¥Ό ν…μ¤νΈν–κ³ , μ™ νΉμ • APIλ” ν…μ¤νΈν•μ§€ μ•μ•λ”μ§€ λ…ν™•ν κΈ°λ΅ν•©λ‹λ‹¤.

---

## π― ν†µν•© ν…μ¤νΈ κΈ°μ¤€

### β… λ°λ“μ‹ ν…μ¤νΈν•λ” κ²½μ°

1. **λμ΄ μ¤κ°€λ” API**
   - κ²°μ , ν™λ¶, ν¬μΈνΈ μ¶©μ „/μ‚¬μ©
   - μΏ ν° λ°κΈ‰/μ‚¬μ©
   - μ΄μ : λ°μ΄ν„° μ •ν•©μ„±μ΄ λ§¤μ° μ¤‘μ”

2. **λ™μ‹μ„± λ¬Έμ κ°€ μλ” API**
   - μ¬κ³  μ°¨κ°
   - μΏ ν° λ°κΈ‰ (μ„ μ°©μ)
   - ν¬μΈνΈ μ‚¬μ©
   - μ΄μ : Race Condition λ°©μ§€

3. **λ³µμ΅ν• λΉ„μ¦λ‹μ¤ λ΅μ§**
   - μ£Όλ¬Έ μƒμ„± (μ¬κ³  μ°¨κ° + ν¬μΈνΈ μ‚¬μ© + μΏ ν° μ μ©)
   - μ£Όλ¬Έ μ·¨μ† (μ¬κ³  λ³µκµ¬ + ν¬μΈνΈ ν™λ¶)
   - μ΄μ : μ—¬λ¬ λ„λ©”μΈμ΄ μ—°κ³„λμ–΄ ν†µν•© ν…μ¤νΈ ν•„μ

4. **μ—¬λ¬ ν…μ΄λΈ”μ„ JOINν•λ” λ³µμ΅ν• μ΅°ν**
   - μ£Όλ¬Έ μƒμ„Έ μ΅°ν (Order + OrderItem + Product)
   - μ‚¬μ©μ μ£Όλ¬Έ λ©λ΅ (N+1 λ¬Έμ  κ²€μ¦)
   - μ΄μ : μ„±λ¥ λ° λ°μ΄ν„° μ •ν•©μ„± κ²€μ¦

### β ν…μ¤νΈν•μ§€ μ•λ” κ²½μ°

1. **λ‹¨μ CRUD**
   - GET /users/{id} (λ‹¨μ μ΅°ν)
   - GET /products (λ‹¨μ λ©λ΅)
   - μ΄μ : λΉ„μ¦λ‹μ¤ λ΅μ§ μ—†μ, Repository ν…μ¤νΈλ΅ μ¶©λ¶„

2. **λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ μ—†λ” API**
   - λ‹¨μ μ΅°ν
   - λ‹¨μ μ €μ¥
   - μ΄μ : Unit ν…μ¤νΈλ΅ μ¶©λ¶„

3. **Unit ν…μ¤νΈλ΅ μ¶©λ¶„ν• κ²½μ°**
   - Service λ μ΄μ–΄μ—μ„ μ΄λ―Έ κ²€μ¦λ¨
   - μ΄μ : ν†µν•© ν…μ¤νΈ λΉ„μ© λ€λΉ„ ν¨κ³Ό λ‚®μ

---

## π“ API ν†µν•© ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€

### 1. Order (μ£Όλ¬Έ)

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| POST /orders | μ£Όλ¬Έ μƒμ„± | β… μ™„λ£ | ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§, λ³µμ΅ν• νΈλμ­μ… |
| GET /orders/{orderId} | μ£Όλ¬Έ μ΅°ν | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |
| GET /orders?userId={userId} | μ‚¬μ©μ μ£Όλ¬Έ λ©λ΅ | β… μ¶”κ°€ ν•„μ” | JOIN λ§μ, N+1 κ²€μ¦ |
| POST /orders/{orderId}/confirm | μ£Όλ¬Έ ν™•μ • | β… μ¶”κ°€ ν•„μ” | μƒνƒ λ³€κ²½ λ΅μ§ |
| POST /orders/{orderId}/cancel | μ£Όλ¬Έ μ·¨μ† | β… μ¶”κ°€ ν•„μ” | μ¬κ³  λ³µκµ¬, ν¬μΈνΈ ν™λ¶ |

### 2. Payment (κ²°μ )

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| POST /payments | κ²°μ  μƒμ„± | β… μ™„λ£ | λμ΄ μ¤κ°€λ” API |
| GET /payments/{paymentId} | κ²°μ  μ΅°ν | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |

### 3. Point (ν¬μΈνΈ)

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| POST /point/charge | ν¬μΈνΈ μ¶©μ „ | β… μ™„λ£ | λμ΄ μ¤κ°€λ” API |
| POST /point/use | ν¬μΈνΈ μ‚¬μ© | β… μ™„λ£ | λ™μ‹μ„± λ¬Έμ , μ”μ•΅ κ²€μ¦ |
| POST /point/expire | ν¬μΈνΈ λ§λ£ | β… μ™„λ£ | λΉ„μ¦λ‹μ¤ λ΅μ§ |
| GET /point/{userId} | ν¬μΈνΈ μ΅°ν | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |
| GET /point/{userId}/history | ν¬μΈνΈ νμ¤ν† λ¦¬ | β… μ¶”κ°€ ν•„μ” | νμ΄μ§•, μ •λ ¬ κ²€μ¦ |

### 4. Coupon (μΏ ν°)

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| POST /coupon/issue | μΏ ν° λ°κΈ‰ | β… μ™„λ£ | μ„ μ°©μ, λ™μ‹μ„± λ¬Έμ  |
| GET /coupon/{userId} | μ‚¬μ©μ μΏ ν° μ΅°ν | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |

### 5. Inventory (μ¬κ³ )

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| POST /inventory/deduct | μ¬κ³  μ°¨κ° | β… μ™„λ£ | λ™μ‹μ„± λ¬Έμ , μ¬κ³  κ²€μ¦ |
| GET /inventory/{productId} | μ¬κ³  μ΅°ν | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |

### 6. Cart (μ¥λ°”κµ¬λ‹)

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| POST /cart | μ¥λ°”κµ¬λ‹ μ¶”κ°€ | β… μ™„λ£ | λΉ„μ¦λ‹μ¤ λ΅μ§ (ν‹° μ„ νƒ) |
| GET /cart/{userId} | μ¥λ°”κµ¬λ‹ μ΅°ν | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |
| DELETE /cart/{cartId} | μ¥λ°”κµ¬λ‹ μ‚­μ  | β λ¶ν•„μ” | λ‹¨μ μ‚­μ  |

### 7. Product (μƒν’)

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| GET /products | μƒν’ λ©λ΅ | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |
| GET /products/{productId} | μƒν’ μ΅°ν | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |
| GET /products/{productId}/statistics | μƒν’ ν†µκ³„ | β… μ™„λ£ | λ³µμ΅ν• μ§‘κ³„ λ΅μ§ |

### 8. User (μ‚¬μ©μ)

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| POST /users | μ‚¬μ©μ μƒμ„± | β… μ™„λ£ | μ ν¨μ„± κ²€μ¦ |
| GET /users/{userId} | μ‚¬μ©μ μ΅°ν | β λ¶ν•„μ” | λ‹¨μ μ΅°ν |

### 9. Delivery (λ°°μ†΅)

| API | Method | ν…μ¤νΈ μ—¬λ¶€ | μ΄μ  |
|-----|--------|------------|------|
| GET /delivery/{orderId}/status | λ°°μ†΅ μƒνƒ μ΅°ν | β… μ™„λ£ | μ™Έλ¶€ API μ—°λ™ μ‹λ®¬λ μ΄μ… |

---

## π“ ν†µν•© ν…μ¤νΈ ν†µκ³„

### ν„μ¬ μƒνƒ
- **μ΄ API μ:** μ•½ 25κ°
- **ν†µν•© ν…μ¤νΈ μ‘μ„±:** 14κ°
- **μ»¤λ²„λ¦¬μ§€:** μ•½ 56%

### μ°μ„ μμ„λ³„ μ»¤λ²„λ¦¬μ§€
- **High Priority (ν•„μ):** 90% (9/10 μ™„λ£)
- **Medium Priority (κ¶μ¥):** 50% (2/4 μ™„λ£)
- **Low Priority (μ„ νƒ):** 0% (λ¶ν•„μ”)

---

## π€ μ¶”κ°€ μμ • ν†µν•© ν…μ¤νΈ

### 1. OrderCancelIntegrationTest (High Priority)
**λ©μ :** μ£Όλ¬Έ μ·¨μ† μ‹ μ¬κ³  λ³µκµ¬ λ° ν¬μΈνΈ ν™λ¶ κ²€μ¦

**μ‹λ‚λ¦¬μ¤:**
1. μ£Όλ¬Έ μƒμ„± (ν¬μΈνΈ μ‚¬μ© + μ¬κ³  μ°¨κ°)
2. μ£Όλ¬Έ μ·¨μ†
3. κ²€μ¦:
   - μ¬κ³ κ°€ μ›λ³µλμ—λ”μ§€
   - ν¬μΈνΈκ°€ ν™λ¶λμ—λ”μ§€
   - μ£Όλ¬Έ μƒνƒκ°€ CANCELLEDμΈμ§€

### 2. OrderConfirmIntegrationTest (High Priority)
**λ©μ :** μ£Όλ¬Έ ν™•μ • μ‹ μƒνƒ λ³€κ²½ λ° λ°°μ†΅ μ‹μ‘ κ²€μ¦

**μ‹λ‚λ¦¬μ¤:**
1. μ£Όλ¬Έ μƒμ„± (PENDING)
2. μ£Όλ¬Έ ν™•μ •
3. κ²€μ¦:
   - μ£Όλ¬Έ μƒνƒκ°€ CONFIRMEDμΈμ§€
   - λ°°μ†΅μ΄ μ‹μ‘λμ—λ”μ§€

### 3. OrderListIntegrationTest (Medium Priority)
**λ©μ :** μ‚¬μ©μ μ£Όλ¬Έ λ©λ΅ μ΅°ν μ‹ N+1 λ¬Έμ  κ²€μ¦

**μ‹λ‚λ¦¬μ¤:**
1. μ‚¬μ©μμ μ£Όλ¬Έ 10κ° μƒμ„±
2. μ£Όλ¬Έ λ©λ΅ μ΅°ν
3. κ²€μ¦:
   - μΏΌλ¦¬ μκ°€ 1~2κ°μΈμ§€ (N+1 μ—†μ)
   - νμ΄μ§•μ΄ μ •μƒ λ™μ‘ν•λ”μ§€

### 4. PointHistoryIntegrationTest (Medium Priority)
**λ©μ :** ν¬μΈνΈ νμ¤ν† λ¦¬ μ΅°ν μ‹ νμ΄μ§• λ° μ •λ ¬ κ²€μ¦

**μ‹λ‚λ¦¬μ¤:**
1. ν¬μΈνΈ κ±°λ 100κ±΄ μƒμ„±
2. νμ¤ν† λ¦¬ μ΅°ν (νμ΄μ§•)
3. κ²€μ¦:
   - μµμ‹  κ±°λκ°€ λ¨Όμ € μ΅°νλλ”μ§€
   - νμ΄μ§•μ΄ μ •μƒ λ™μ‘ν•λ”μ§€

---

## π“ λ™μ‹μ„± ν…μ¤νΈ μ „λµ

### λ™μ‹μ„± ν…μ¤νΈκ°€ ν•„μ”ν• API
1. **POST /point/use** - ν¬μΈνΈ λ™μ‹ μ‚¬μ©
2. **POST /coupon/issue** - μΏ ν° μ„ μ°©μ λ°κΈ‰
3. **POST /inventory/deduct** - μ¬κ³  λ™μ‹ μ°¨κ°

### λ™μ‹μ„± ν…μ¤νΈ λ°©λ²•
```kotlin
// μ: ν¬μΈνΈ λ™μ‹μ„± ν…μ¤νΈ
it("λ™μ‹μ— ν¬μΈνΈλ¥Ό μ‚¬μ©ν•΄λ„ μ”μ•΅μ΄ μ •ν™•ν•΄μ•Ό ν•λ‹¤") {
    // Given
    val userId = 1L
    pointService.charge(userId, 10000L)

    // When: 10κ° μ¤λ λ“κ°€ λ™μ‹μ— 1000μ›μ”© μ‚¬μ©
    val results = (1..10).map {
        async {
            pointService.use(userId, 1000L)
        }
    }.awaitAll()

    // Then
    val balance = pointService.getBalance(userId)
    balance shouldBe 0L  // μ •ν™•ν 0μ›μ΄μ–΄μ•Ό ν•¨
}
```

---

## π“ ν†µν•© ν…μ¤νΈ μ‘μ„± κ°€μ΄λ“

### 1. ν…μ¤νΈ κµ¬μ΅°
```kotlin
class XxxIntegrationTest(
    private val xxxService: XxxService
) : KotestIntegrationTestBase({

    describe("κΈ°λ¥ μ„¤λ…") {
        context("μ΅°κ±΄") {
            it("μμƒ κ²°κ³Ό") {
                // Given (μ¤€λΉ„)
                // When (μ‹¤ν–‰)
                // Then (κ²€μ¦)
            }
        }
    }
})
```

### 2. ν…μ¤νΈ λ°μ΄ν„° μ¤€λΉ„
- `@BeforeEach`λ΅ κ³µν†µ λ°μ΄ν„° μ¤€λΉ„
- ν…μ¤νΈ κ°„ κ²©λ¦¬λ¥Ό μ„ν•΄ νΈλμ­μ… λ΅¤λ°± ν™μ©

### 3. κ²€μ¦ ν•­λ©
- β… λ°μ΄ν„° μ •ν•©μ„± (μ €μ¥λ κ°’μ΄ μ •ν™•ν•μ§€)
- β… μμ™Έ μ²λ¦¬ (μλ»λ μ”μ²­ μ‹ μ¬λ°”λ¥Έ μμ™Έ)
- β… μƒνƒ λ³€κ²½ (μ£Όλ¬Έ μƒνƒ, μ¬κ³  λ“±)
- β… μ—°κ΄€ λ°μ΄ν„° (μ£Όλ¬Έ μƒμ„± μ‹ OrderItemλ„ ν•¨κ»)

---

## π― κ²°λ΅ 

### ν†µν•© ν…μ¤νΈ μ² ν•™
- **λ¨λ“  APIλ¥Ό ν…μ¤νΈν•μ§€ μ•μµλ‹λ‹¤**
- **ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§λ§ μ„ νƒμ μΌλ΅ ν…μ¤νΈν•©λ‹λ‹¤**
- **λΉ„μ© λ€λΉ„ ν¨κ³Όλ¥Ό κ³ λ ¤ν•©λ‹λ‹¤**

### ν„μ¬ μ»¤λ²„λ¦¬μ§€
- ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§μ€ 90% μ»¤λ²„
- λ™μ‹μ„± λ¬Έμ λ” 100% μ»¤λ²„
- λ‹¨μ CRUDλ” μλ„μ μΌλ΅ μ μ™Έ

### μ¶”κ°€ κ³„ν
- μ£Όλ¬Έ μ·¨μ†/ν™•μ • ν…μ¤νΈ μ¶”κ°€ μμ •
- N+1 λ¬Έμ  κ²€μ¦ ν…μ¤νΈ μ¶”κ°€ μμ •
- νμ΄μ§• ν…μ¤νΈ μ¶”κ°€ μμ •
